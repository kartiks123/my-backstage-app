{"version":3,"file":"index.esm.js","sources":["../src/api/client.ts","../src/plugin.ts"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { OAuthApi, createApiRef, FetchApi } from '@backstage/core-plugin-api';\nimport { ResponseError } from '@backstage/errors';\nimport { MicrosoftCalendarEvent, MicrosoftCalendar } from './types';\n\n/** @public */\nexport const microsoftCalendarApiRef = createApiRef<MicrosoftCalendarApiClient>(\n  {\n    id: 'plugin.microsoft-calendar.service',\n  },\n);\n\n/** @public */\nexport class MicrosoftCalendarApiClient {\n  private readonly authApi: OAuthApi;\n  private readonly fetchApi: FetchApi;\n\n  constructor(options: { authApi: OAuthApi; fetchApi: FetchApi }) {\n    this.authApi = options.authApi;\n    this.fetchApi = options.fetchApi;\n  }\n\n  private async get<T>(\n    path: string,\n    params: { [key in string]: any } = {},\n    headers?: any,\n  ): Promise<T> {\n    const query = new URLSearchParams(params);\n    const url = new URL(\n      `${path}?${query.toString()}`,\n      'https://graph.microsoft.com',\n    );\n    const token = await this.authApi.getAccessToken();\n    let temp: any = {};\n\n    if (headers && typeof headers === 'object') {\n      temp = {\n        ...headers,\n      };\n    }\n\n    if (token) {\n      temp.Authorization = `Bearer ${token}`;\n    }\n\n    const response = await this.fetchApi.fetch(url.toString(), {\n      headers: temp,\n    });\n\n    if (!response.ok) {\n      throw await ResponseError.fromResponse(response);\n    }\n\n    return response.json() as Promise<T>;\n  }\n\n  public async getCalendars(): Promise<MicrosoftCalendar[]> {\n    const data = await this.get<{\n      id: string;\n      value: MicrosoftCalendar[];\n    }>('v1.0/me/calendars');\n\n    return data.value;\n  }\n\n  public async getEvents(\n    calendarId: string,\n    params: {\n      startDateTime: string;\n      endDateTime: string;\n    },\n    headers: { [key in string]: any },\n  ): Promise<MicrosoftCalendarEvent[]> {\n    const data = await this.get<{\n      id: string;\n      value: [MicrosoftCalendarEvent];\n    }>(`v1.0/me/calendars/${calendarId}/calendarview`, params, headers);\n    return data.value;\n  }\n}\n","/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  createPlugin,\n  microsoftAuthApiRef,\n  fetchApiRef,\n  createApiFactory,\n  createComponentExtension,\n} from '@backstage/core-plugin-api';\nimport {\n  microsoftCalendarApiRef,\n  MicrosoftCalendarApiClient,\n} from './api/index';\n\nexport const microsoftCalendarPlugin = createPlugin({\n  id: 'microsoft-calendar',\n  apis: [\n    createApiFactory({\n      api: microsoftCalendarApiRef,\n      deps: { authApi: microsoftAuthApiRef, fetchApi: fetchApiRef },\n      factory(deps) {\n        return new MicrosoftCalendarApiClient(deps);\n      },\n    }),\n  ],\n});\n\n/** @public */\nexport const MicrosoftCalendarCard = microsoftCalendarPlugin.provide(\n  createComponentExtension({\n    name: 'MicrosoftCalendarCard',\n    component: {\n      lazy: () => import('./components').then(m => m.MicrosoftCalendar),\n    },\n  }),\n);\n"],"names":[],"mappings":"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"}